# SpotRate

## Начало работы 

1. Установка зависимостей

   ```bash
   npm install
   ```

2. Запуск приложения

   ```bash
    npx expo start
   ```

## Тестирование

1. Скачайте приложение `Expo Go` на смартфон
2. Убедитесь, что ПК, на котором запущен сервер, находится в одной сети со смартфоном
3. Отсканируйте QR-код в консоли через `Expo Go`

## Лаб. 1

### Разработка

#### Принятые решения

Для хранения данных маркеров в этой работе использован `Context` из `'react'` (т.к. в этой работе не используется БД)

#### Дополнительный функционал

1. Получение локации пользователя и перемещение к ней
2. Закрытие окна маркера свайпом вниз

### Известные проблемы

По какой-то причине переход к локации пользователя первый раз может происходить долго, хотя, судя по логам, права и локация уже получены

## Лаб. 2

### Подготовка

Для организации работы с БД используется ORM Drizzle.

**Установка и настройка:**

```bash
npm install drizzle-orm drizzle-kit expo-sqlite
```

Далее, для корректной настройки необходимо выполнить шаги:
[Drizzle Expo SQLite](https://orm.drizzle.team/docs/connect-expo-sqlite)

### Разработка

#### Принятые решения

Для работы с данными из БД была изменена реализация существующих `MarkerContext` и `MarkerImageContext`.\
Таким образом, компоненты, использующие контексты, меньше подверглись изменениям. 

#### Схема БД

```mermaid
  erDiagram
      markers ||--o{ markerImages
      markers {
          integer id PK "autoIncrement"
          text title
          text description
          real latitude
          real longitude
          text created_at
      }
      markerImages {
          integer id PK "autoIncrement"
          integer marker_id FK
          text uri
          text created_at
      }
```

#### Реализация работы ORM

**Организация папок:**

```
SpotRate
L-- context
| L- MarkerContext.tsx      // Операции маркерами
| L- MarkerImageContext.tsx // Операции с картинками маркеров
|
L-- database
| L-- client.ts // Экземпляр БД
| L-- schema.ts // Описание схемы БД
|
L-- drizzle
  L *сгенерированные drizzle-kit файлы, миграции*
```

Для совместимости с существующим кодом внутри контекстов реализованы методы маппинга сущностей БД (`DbMarkerSelect, DbMarkerInsert, ..`) к существующим интерфейсам (`Marker, MarkerImage`).
Применение миграций происходит в `RootLayout`.

#### Дополнительный функционал

* Взаимодействие с базой данных было организовано с использованием Drizzle
* Реализован механизм миграций при запуске приложения

#### Известные проблемы

Необходимо внимательно следовать инструкции из [подготовки](#подготовка), чтобы настроить работу с БД без ошибок